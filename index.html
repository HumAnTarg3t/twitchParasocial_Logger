<!DOCTYPE html>
<html>
  <head>
    <title>My Electron App</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="tabLinks"></div>
    <div class="tabs"></div>

    <script>
      window.addEventListener("DOMContentLoaded", async () => {
        const tabLinksContainer = document.querySelector(".tabLinks");
        const tabsContainer = document.querySelector(".tabs");

        // Fetching data from local JSON file
        const streamerListFromConfig = await fetch("config.json");
        const streamerList = await streamerListFromConfig.json();
        const streamerListArray = streamerList.data;
        try {
          streamerList.data.forEach((item, index) => {
            // Create tab link
            const tabLink = document.createElement("button");
            tabLink.textContent = item;
            tabLink.addEventListener("click", () => showTab(index));
            tabLinksContainer.appendChild(tabLink);

            // Create tab content
            const tabContent = document.createElement("div");
            tabContent.className = "tab";
            tabContent.setAttribute("id", item);
            // tabContent.textContent = `Content for ${item}`;
            tabsContainer.appendChild(tabContent);
          });

          showTab(0); // Show the first tab initially
        } catch (error) {
          console.error("Error fetching or parsing data:", error);
        }

        // const test = document.getElementsByClassName("tabLinks").childNodes;
        // console.log(test);

        // Function to show tab based on index
        function showTab(index) {
          const tabs = document.querySelectorAll(".tab");
          const tabLinks = document.querySelectorAll(".tabLinks button");

          tabs.forEach((tab) => (tab.style.display = "none"));
          tabLinks.forEach((link) => link.classList.remove("active"));

          tabs[index].style.display = "block";
          tabLinks[index].classList.add("active");
          const documentHeight = Math.max(
            document.body.scrollHeight,
            document.body.offsetHeight,
            document.documentElement.clientHeight,
            document.documentElement.scrollHeight,
            document.documentElement.offsetHeight
          );

          // Get the button with the class "active" inside the div with the class "tabLinks"
          const activeButton = document.querySelector(".tabLinks .active");

          // Check if an active button was found
          if (activeButton) {
            // Get the inner text of the active button
            const buttonText = activeButton.innerText;
            document.title = `${buttonText}s chat`;
          } else {
            console.log('No button with class "active" found.');
          }

          window.scrollTo({
            top: documentHeight,
          });
        }

        let autoScrollflag;
        autoScrollflag = true;

        function scrollToBottom(autoScrollflag) {
          if (autoScrollflag) {
            const documentHeight = Math.max(
              document.body.scrollHeight,
              document.body.offsetHeight,
              document.documentElement.clientHeight,
              document.documentElement.scrollHeight,
              document.documentElement.offsetHeight
            );
            window.scrollTo({
              top: documentHeight,
              behavior: "smooth", // Use smooth scrolling behavior
            });
          } else {
            // console.log("no scroll");
          }
        }

        function handleScroll(event) {
          const contentHeight = document.body.scrollHeight;
          const yOffset = window.pageYOffset;
          const windowHeight = window.innerHeight;

          if (event.deltaY < 0) {
            // console.log("Scroll up");
            // Add your actions for scrolling up here
            autoScrollflag = false;
          } else if (yOffset + windowHeight >= contentHeight - 100) {
            autoScrollflag = true;
          }
        }

        // Event listener for scroll event
        window.addEventListener("wheel", handleScroll);

        document.addEventListener("keydown", (event) => {
          if (event.ctrlKey && event.key === "f") {
            //Noe logikk for å søke gjennom DOM
          }
        });

        window.api.receive("log-message", (ClientPayload) => {
          const channelFromTwitch = ClientPayload.messageInfo.channel;
          const channelFromTwitchSliced = channelFromTwitch.slice(1);
          const consoleOutput = document.getElementById(channelFromTwitchSliced);
          const twitchUsernameLowerCase = ClientPayload.messageInfo.username.toLowerCase();
          if (streamerListArray.includes(twitchUsernameLowerCase)) {
            //make streamer name red
            // consoleOutput.innerHTML += `<p id="${channelFromTwitchSliced}">${ClientPayload.messageInfo.date_tmi_sent_ts} <p class="streamerName" ${ClientPayload.messageInfo.username}/p>: ${ClientPayload.messageInfo.message}</p>`;
            consoleOutput.innerHTML += `
    <p class="${channelFromTwitchSliced}"
    <p class="dateCSS" style="display: inline-block; margin: 0">${ClientPayload.messageInfo.date_tmi_sent_ts}</p>
    <p class="streamerIdCSS" style="display: inline-block; margin: 0">${ClientPayload.messageInfo.username}: </p>
    <p class="msgCSS" style="display: inline-block; margin: 0">${ClientPayload.messageInfo.message}</p>
  </p>
    `;
          } else {
            // consoleOutput.innerHTML += `<p id="${channelFromTwitchSliced}">${ClientPayload.messageInfo.date_tmi_sent_ts} ${ClientPayload.messageInfo.username}: ${ClientPayload.messageInfo.message}</p>`;
            consoleOutput.innerHTML += `
    <p class="${channelFromTwitchSliced}"
    <p class="dateCSS" style="display: inline-block; margin: 0">${ClientPayload.messageInfo.date_tmi_sent_ts}</p>
    <p class="normalFrogIdCSS" style="display: inline-block; margin: 0">${ClientPayload.messageInfo.username}: </p>
    <p class="msgCSS" style="display: inline-block; margin: 0">${ClientPayload.messageInfo.message}</p>
  </p>
    `;
          }
          // console.log(ClientPayload);
          scrollToBottom(autoScrollflag);
        });
      });
    </script>
  </body>
</html>
